
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://github.com/ConsenSys/smart-contract-best-practices/solidity_recommendations/">
      
      
        <meta name="author" content="ConsenSys">
      
      
        <link rel="shortcut icon" href="../images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.10.3">
    
    
      
        <title>Recommendations for Secure Solidity Code - Ethereum Smart Contract Best Practices</title>
      
    
    
      <script src="../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-9011e2d3f8.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://github.com/ConsenSys/smart-contract-best-practices" title="Ethereum Smart Contract Best Practices" class="md-header-nav__button md-logo">
          
            <i class="md-icon md-icon--home"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Recommendations for Secure Solidity Code
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/ConsenSys/smart-contract-best-practices" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <div class="md-nav__button md-logo">
      
        <i class="md-icon md-icon--home"></i>
      
    </div>
    Ethereum Smart Contract Best Practices
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/ConsenSys/smart-contract-best-practices" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../general_philosophy/" title="General Philosophy" class="md-nav__link">
      General Philosophy
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../protocol_recommendations/" title="Recommendations for Smart Contract Logic" class="md-nav__link">
      Recommendations for Smart Contract Logic
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Recommendations for Secure Solidity Code
      </label>
    
    <a href="./" title="Recommendations for Secure Solidity Code" class="md-nav__link md-nav__link--active">
      Recommendations for Secure Solidity Code
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#external-calls" title="External Calls" class="md-nav__link">
    External Calls
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-caution-when-making-external-calls" title="Use caution when making external calls" class="md-nav__link">
    Use caution when making external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mark-untrusted-contracts" title="Mark untrusted contracts" class="md-nav__link">
    Mark untrusted contracts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#be-aware-of-the-tradeoffs-between-send-transfer-and-callvalue" title="Be aware of the tradeoffs between send(), transfer(), and call.value()()" class="md-nav__link">
    Be aware of the tradeoffs between send(), transfer(), and call.value()()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-assert-and-require-properly" title="Use assert() and require() properly" class="md-nav__link">
    Use assert() and require() properly
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remember-that-ether-can-be-forcibly-sent-to-an-account" title="Remember that Ether can be forcibly sent to an account" class="md-nav__link">
    Remember that Ether can be forcibly sent to an account
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beware-rounding-with-integer-division" title="Beware rounding with integer division" class="md-nav__link">
    Beware rounding with integer division
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces" title="Be aware of the tradeoffs between abstract contracts and interfaces" class="md-nav__link">
    Be aware of the tradeoffs between abstract contracts and interfaces
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keep-fallback-functions-simple" title="Keep fallback functions simple" class="md-nav__link">
    Keep fallback functions simple
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explicitly-mark-visibility-in-functions-and-state-variables" title="Explicitly mark visibility in functions and state variables" class="md-nav__link">
    Explicitly mark visibility in functions and state variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lock-pragmas-to-specific-compiler-version" title="Lock pragmas to specific compiler version" class="md-nav__link">
    Lock pragmas to specific compiler version
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#differentiate-functions-and-events" title="Differentiate functions and events" class="md-nav__link">
    Differentiate functions and events
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefer-newer-solidity-constructs" title="Prefer newer Solidity constructs" class="md-nav__link">
    Prefer newer Solidity constructs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#be-aware-that-built-ins-can-be-shadowed" title="Be aware that 'Built-ins' can be shadowed" class="md-nav__link">
    Be aware that 'Built-ins' can be shadowed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avoid-using-txorigin" title="Avoid using tx.origin" class="md-nav__link">
    Avoid using tx.origin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprecatedhistorical-recommendations" title="Deprecated/historical recommendations" class="md-nav__link">
    Deprecated/historical recommendations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beware-division-by-zero-solidity-04" title="Beware division by zero (Solidity &lt; 0.4)" class="md-nav__link">
    Beware division by zero (Solidity &lt; 0.4)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../protocol_attacks/" title="Protocol Attacks" class="md-nav__link">
      Protocol Attacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../solidity_attacks/" title="Solidity Attacks" class="md-nav__link">
      Solidity Attacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../software_engineering/" title="Software Engineering Techniques" class="md-nav__link">
      Software Engineering Techniques
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../documentation_procedures/" title="Documentation and Procedures" class="md-nav__link">
      Documentation and Procedures
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../security_tools/" title="Security Tools" class="md-nav__link">
      Security Tools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../security_notifications/" title="Security Notifications" class="md-nav__link">
      Security Notifications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../future_improvements/" title="Future improvements" class="md-nav__link">
      Future improvements
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../bibliography/" title="Smart Contract Security Bibliography" class="md-nav__link">
      Smart Contract Security Bibliography
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../about/reviewers/" title="Reviewers" class="md-nav__link">
      Reviewers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../about/contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#external-calls" title="External Calls" class="md-nav__link">
    External Calls
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-caution-when-making-external-calls" title="Use caution when making external calls" class="md-nav__link">
    Use caution when making external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mark-untrusted-contracts" title="Mark untrusted contracts" class="md-nav__link">
    Mark untrusted contracts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#be-aware-of-the-tradeoffs-between-send-transfer-and-callvalue" title="Be aware of the tradeoffs between send(), transfer(), and call.value()()" class="md-nav__link">
    Be aware of the tradeoffs between send(), transfer(), and call.value()()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-assert-and-require-properly" title="Use assert() and require() properly" class="md-nav__link">
    Use assert() and require() properly
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remember-that-ether-can-be-forcibly-sent-to-an-account" title="Remember that Ether can be forcibly sent to an account" class="md-nav__link">
    Remember that Ether can be forcibly sent to an account
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beware-rounding-with-integer-division" title="Beware rounding with integer division" class="md-nav__link">
    Beware rounding with integer division
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces" title="Be aware of the tradeoffs between abstract contracts and interfaces" class="md-nav__link">
    Be aware of the tradeoffs between abstract contracts and interfaces
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keep-fallback-functions-simple" title="Keep fallback functions simple" class="md-nav__link">
    Keep fallback functions simple
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explicitly-mark-visibility-in-functions-and-state-variables" title="Explicitly mark visibility in functions and state variables" class="md-nav__link">
    Explicitly mark visibility in functions and state variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lock-pragmas-to-specific-compiler-version" title="Lock pragmas to specific compiler version" class="md-nav__link">
    Lock pragmas to specific compiler version
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#differentiate-functions-and-events" title="Differentiate functions and events" class="md-nav__link">
    Differentiate functions and events
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefer-newer-solidity-constructs" title="Prefer newer Solidity constructs" class="md-nav__link">
    Prefer newer Solidity constructs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#be-aware-that-built-ins-can-be-shadowed" title="Be aware that 'Built-ins' can be shadowed" class="md-nav__link">
    Be aware that 'Built-ins' can be shadowed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avoid-using-txorigin" title="Avoid using tx.origin" class="md-nav__link">
    Avoid using tx.origin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprecatedhistorical-recommendations" title="Deprecated/historical recommendations" class="md-nav__link">
    Deprecated/historical recommendations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beware-division-by-zero-solidity-04" title="Beware division by zero (Solidity &lt; 0.4)" class="md-nav__link">
    Beware division by zero (Solidity &lt; 0.4)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ConsenSys/smart-contract-best-practices/edit/master/docs/solidity_recommendations.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Recommendations for Secure Solidity Code</h1>
                
                <p>This page demonstrates a number of solidity patterns which should generally be followed when writing smart contracts.</p>
<h2 id="external-calls">External Calls<a class="headerlink" href="#external-calls" title="Permanent link">&para;</a></h2>
<h3 id="use-caution-when-making-external-calls">Use caution when making external calls<a class="headerlink" href="#use-caution-when-making-external-calls" title="Permanent link">&para;</a></h3>
<p>Calls to untrusted contracts can introduce several unexpected risks or errors. External calls may execute malicious code in that contract <em>or</em> any other contract that it depends upon. As such, every external call should be treated as a potential security risk. When it is not possible, or undesirable to remove external calls, use the recommendations in the rest of this section to minimize the danger.</p>
<h3 id="mark-untrusted-contracts">Mark untrusted contracts<a class="headerlink" href="#mark-untrusted-contracts" title="Permanent link">&para;</a></h3>
<p>When interacting with external contracts, name your variables, methods, and contract interfaces in a way that makes it clear that interacting with them is potentially unsafe. This applies to your own functions that call external contracts.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="n">Bank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// Unclear whether trusted or untrusted</span>

<span class="kd">function</span> <span class="n">makeWithdrawal</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Isn&#39;t clear that this function is potentially unsafe</span>
    <span class="n">Bank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// good</span>
<span class="n">UntrustedBank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// untrusted external call</span>
<span class="n">TrustedBank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// external but trusted bank contract maintained by XYZ Corp</span>

<span class="kd">function</span> <span class="n">makeUntrustedWithdrawal</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UntrustedBank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h3 id="be-aware-of-the-tradeoffs-between-send-transfer-and-callvalue">Be aware of the tradeoffs between <code>send()</code>, <code>transfer()</code>, and <code>call.value()()</code><a class="headerlink" href="#be-aware-of-the-tradeoffs-between-send-transfer-and-callvalue" title="Permanent link">&para;</a></h3>
<p>When sending ether be aware of the relative tradeoffs between the use of
<code>someAddress.send()</code>, <code>someAddress.transfer()</code>, and <code>someAddress.call.value()()</code>.</p>
<ul>
<li><code>someAddress.send()</code>and <code>someAddress.transfer()</code> are considered <em>safe</em> against <a href="#reentrancy">reentrancy</a>.
    While these methods still trigger code execution, the called contract is
    only given a stipend of 2,300 gas which is currently only enough to log an
    event.</li>
<li><code>x.transfer(y)</code> is equivalent to <code>require(x.send(y));</code>, it will automatically revert if the send fails.</li>
<li><code>someAddress.call.value(y)()</code> will send the provided ether and trigger code execution.<br />
    The executed code is given all available gas for execution making this type of value transfer <em>unsafe</em> against reentrancy.</li>
</ul>
<p>Using <code>send()</code> or <code>transfer()</code> will prevent reentrancy but it does so at the cost of being incompatible with any contract whose fallback function requires more than 2,300 gas. It is also possible to use <code>someAddress.call.value(ethAmount).gas(gasAmount)()</code> to forward a custom amount of gas.</p>
<p>One pattern that attempts to balance this trade-off is to implement both
a <a href="#favor-pull-over-push-payments"><em>push</em> and <em>pull</em></a> mechanism, using <code>send()</code> or <code>transfer()</code>
for the <em>push</em> component and <code>call.value()()</code> for the <em>pull</em> component.</p>
<p>It is worth pointing out that exclusive use of <code>send()</code> or <code>transfer()</code> for value transfers
does not itself make a contract safe against reentrancy but only makes those
specific value transfers safe against reentrancy.</p>
<h2 id="use-assert-and-require-properly">Use <code>assert()</code> and <code>require()</code> properly<a class="headerlink" href="#use-assert-and-require-properly" title="Permanent link">&para;</a></h2>
<p>In Solidity 0.4.10 <code>assert()</code> and <code>require()</code> were introduced. <code>require(condition)</code> is meant to be used for input validation, which should be done on any user input, and reverts if the condition is false. <code>assert(condition)</code> also reverts if the condition is false but should be used only for invariants: internal errors or to check if your contract has reached an invalid state. Following this paradigm allows formal analysis tools to verify that the invalid opcode can never be reached: meaning no invariants in the code are violated and that the code is formally verified.</p>
<p>For example, the token to ether issuance ratio, in a token issuance contract, may be fixed. You can verify that this is the case at all times with an <code>assert()</code>. Assert guards should often be combined with other techniques, such as pausing the contract and allowing upgrades. (Otherwise, you may end up stuck, with an assertion that is always failing.)</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">Token</span> <span class="p">{</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="n">balanceOf</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">totalSupply</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">deposit</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="n">balanceOf</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">;</span>
        <span class="n">totalSupply</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">;</span>
        <span class="nb">assert</span><span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span> <span class="o">&gt;=</span> <span class="n">totalSupply</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Note that the assertion is <em>not</em> a strict equality of the balance because the contract can be <a href="#ether-forcibly-sent">forcibly sent ether</a> without going through the <code>deposit()</code> function!</p>
<h2 id="remember-that-ether-can-be-forcibly-sent-to-an-account">Remember that Ether can be forcibly sent to an account<a class="headerlink" href="#remember-that-ether-can-be-forcibly-sent-to-an-account" title="Permanent link">&para;</a></h2>
<p>Beware of coding an invariant that strictly checks the balance of a contract.</p>
<p>An attacker can forcibly send wei to any account and this cannot be prevented (not even with a fallback function that does a <code>revert()</code>).</p>
<p>The attacker can do this by creating a contract, funding it with 1 wei, and invoking
<code>selfdestruct(victimAddress)</code>.  No code is invoked in <code>victimAddress</code>, so it
cannot be prevented.</p>
<h2 id="beware-rounding-with-integer-division">Beware rounding with integer division<a class="headerlink" href="#beware-rounding-with-integer-division" title="Permanent link">&para;</a></h2>
<p>All integer division rounds down to the nearest integer. If you need more precision, consider using a multiplier, or store both the numerator and denominator.</p>
<p>(In the future, Solidity will have a fixed-point type, which will make this easier.)</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kt">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// Result is 2, all integer divison rounds DOWN to the nearest integer</span>
</pre></div>

<p>Using a multiplier prevents rounding down, this multiplier needs to be accounted for when working with x in the future:</p>
<div class="highlight"><pre><span></span><span class="c1">// good</span>
<span class="kt">uint</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</pre></div>

<p>Storing the numerator and denominator means you can calculate the result of <code>numerator/denominator</code> off-chain:
<div class="highlight"><pre><span></span><span class="c1">// good</span>
<span class="kt">uint</span> <span class="n">numerator</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">uint</span> <span class="n">denominator</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</pre></div></p>
<h2 id="be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces">Be aware of the tradeoffs between abstract contracts and interfaces<a class="headerlink" href="#be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces" title="Permanent link">&para;</a></h2>
<p>Both interfaces and abstract contracts provide one with a customizable and re-usable approach for smart contracts. Interfaces, which were introduced in Solidity 0.4.11, are similar to abstract contracts but cannot have any functions implemented. Interfaces also have limitations such as not being able to access storage or inherit from other interfaces which generally makes abstract contracts more practical. Although, Interfaces are certainly useful for designing contracts prior to implementation. Additionally, it is important to keep in mind that if a contract inherits from an abstract contract it must implement all non-implemented functions via overriding or it will be abstract as well.</p>
<h2 id="keep-fallback-functions-simple">Keep fallback functions simple<a class="headerlink" href="#keep-fallback-functions-simple" title="Permanent link">&para;</a></h2>
<p><a href="http://solidity.readthedocs.io/en/latest/contracts.html#fallback-function">Fallback functions</a> are called when a contract is sent a message with no arguments (or when no function matches), and only has access to 2,300 gas when called from a <code>.send()</code> or <code>.transfer()</code>. If you wish to be able to receive Ether from a <code>.send()</code> or <code>.transfer()</code>, the most you can do in a fallback function is log an event. Use a proper function if a computation or more gas is required.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="p">{</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// good</span>
<span class="kd">function</span> <span class="n">deposit</span><span class="p">()</span> <span class="kr">payable</span> <span class="kr">external</span> <span class="p">{</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">;</span> <span class="p">}</span>

<span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="p">{</span> <span class="n">LogDepositReceived</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">);</span> <span class="p">}</span>
</pre></div>

<h2 id="explicitly-mark-visibility-in-functions-and-state-variables">Explicitly mark visibility in functions and state variables<a class="headerlink" href="#explicitly-mark-visibility-in-functions-and-state-variables" title="Permanent link">&para;</a></h2>
<p>Explicitly label the visibility of functions and state variables. Functions can be specified as being <code>external</code>, <code>public</code>, <code>internal</code> or <code>private</code>. Please understand the differences between them, for example, <code>external</code> may be sufficient instead of <code>public</code>. For state variables, <code>external</code> is not possible. Labeling the visibility explicitly will make it easier to catch incorrect assumptions about who can call the function or access the variable.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kt">uint</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// the default is private for state variables, but it should be made explicit</span>
<span class="kd">function</span> <span class="n">buy</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// the default is public</span>
    <span class="c1">// public code</span>
<span class="p">}</span>

<span class="c1">// good</span>
<span class="kt">uint</span> <span class="kr">private</span> <span class="n">y</span><span class="p">;</span>
<span class="kd">function</span> <span class="n">buy</span><span class="p">()</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="c1">// only callable externally</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">utility</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="c1">// callable externally, as well as internally: changing this code requires thinking about both cases.</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">internalAction</span><span class="p">()</span> <span class="kr">internal</span> <span class="p">{</span>
    <span class="c1">// internal code</span>
<span class="p">}</span>
</pre></div>

<h2 id="lock-pragmas-to-specific-compiler-version">Lock pragmas to specific compiler version<a class="headerlink" href="#lock-pragmas-to-specific-compiler-version" title="Permanent link">&para;</a></h2>
<p>Contracts should be deployed with the same compiler version and flags that they have been tested the most with. Locking the pragma helps ensure that contracts do not accidentally get deployed using, for example, the latest compiler which may have higher risks of undiscovered bugs. Contracts may also be deployed by others and the pragma indicates the compiler version intended by the original authors.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kr">pragma solidity</span> <span class="o">^</span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>


<span class="c1">// good</span>
<span class="kr">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
</pre></div>

<h2 id="differentiate-functions-and-events">Differentiate functions and events<a class="headerlink" href="#differentiate-functions-and-events" title="Permanent link">&para;</a></h2>
<p>Favor capitalization and a prefix in front of events (we suggest <em>Log</em>), to prevent the risk of confusion between functions and events. For functions, always start with a lowercase letter, except for the constructor.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kd">event</span> <span class="n">Transfer</span><span class="p">()</span> <span class="p">{}</span>
<span class="kd">function</span> <span class="nb">transfer</span><span class="p">()</span> <span class="p">{}</span>

<span class="c1">// good</span>
<span class="kd">event</span> <span class="n">LogTransfer</span><span class="p">()</span> <span class="p">{}</span>
<span class="kd">function</span> <span class="nb">transfer</span><span class="p">()</span> <span class="kr">external</span> <span class="p">{}</span>
</pre></div>

<h2 id="prefer-newer-solidity-constructs">Prefer newer Solidity constructs<a class="headerlink" href="#prefer-newer-solidity-constructs" title="Permanent link">&para;</a></h2>
<p>Prefer constructs/aliases such as <code>selfdestruct</code> (over <code>suicide</code>) and <code>keccak256</code> (over <code>sha3</code>).  Patterns like <code>require(msg.sender.send(1 ether))</code> can also be simplified to using <code>transfer()</code>, as in <code>msg.sender.transfer(1 ether)</code>.</p>
<h2 id="be-aware-that-built-ins-can-be-shadowed">Be aware that 'Built-ins' can be shadowed<a class="headerlink" href="#be-aware-that-built-ins-can-be-shadowed" title="Permanent link">&para;</a></h2>
<p>It is currently possible to <a href="https://en.wikipedia.org/wiki/Variable_shadowing">shadow</a> built-in globals in Solidity. This allows contracts to override the functionality of built-ins such as <code>msg</code> and <code>revert()</code>. Although this <a href="https://github.com/ethereum/solidity/issues/1249">is intended</a>, it can mislead users of a contract as to the contract's true behavior.</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">PretendingToRevert</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nb">revert</span><span class="p">()</span> <span class="kr">internal</span> <span class="kr">constant</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">ExampleContract</span> <span class="kr">is</span> <span class="n">PretendingToRevert</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">somethingBad</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nb">revert</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Contract users (and auditors) should be aware of the full smart contract source code of any application they intend to use.</p>
<h2 id="avoid-using-txorigin">Avoid using <code>tx.origin</code><a class="headerlink" href="#avoid-using-txorigin" title="Permanent link">&para;</a></h2>
<p>Never use <code>tx.origin</code> for authorization, another contract can have a method which will call your contract (where the user has some funds for instance) and your contract will authorize that transaction as your address is in <code>tx.origin</code>.</p>
<div class="highlight"><pre><span></span>pragma solidity 0.4.18;

contract MyContract {

    address owner;

    function MyContract() public {
        owner = msg.sender;
    }

    function sendTo(address receiver, uint amount) public {
        require(tx.origin == owner);
        receiver.transfer(amount);
    }

}

contract AttackingContract {

    MyContract myContract;
    address attacker;

    function AttackingContract(address myContractAddress) public {
        myContract = MyContract(myContractAddress);
        attacker = msg.sender;
    }

    function() public {
        myContract.sendTo(attacker, msg.sender.balance);
    }

}
</pre></div>

<p>You should use <code>msg.sender</code> for authorization (if another contract calls your contract <code>msg.sender</code> will be the address of the contract and not the address of the user who called the contract).</p>
<p>You can read more about it here: <a href="https://solidity.readthedocs.io/en/develop/security-considerations.html#tx-origin">Solidity docs</a></p>
<p>Besides the issue with authorization, there is a chance that <code>tx.origin</code> will be removed from the Ethereum protocol in the future, so code that uses <code>tx.origin</code> won't be compatible with future releases <a href="https://ethereum.stackexchange.com/questions/196/how-do-i-make-my-dapp-serenity-proof/200#200">Vitalik: 'Do NOT assume that tx.origin will continue to be usable or meaningful.'</a></p>
<p>It's also worth mentioning that by using <code>tx.origin</code> you're limiting interoperability between contracts because the contract that uses tx.origin cannot be used by another contract as a contract can't be the <code>tx.origin</code>.</p>
<h2 id="deprecatedhistorical-recommendations">Deprecated/historical recommendations<a class="headerlink" href="#deprecatedhistorical-recommendations" title="Permanent link">&para;</a></h2>
<p>These are recommendations which are no longer relevant due to improvements to solidity. They are recorded here for posterity and awareness.</p>
<h3 id="beware-division-by-zero-solidity-04">Beware division by zero (Solidity &lt; 0.4)<a class="headerlink" href="#beware-division-by-zero-solidity-04" title="Permanent link">&para;</a></h3>
<p>Prior to version 0.4, Solidity <a href="https://github.com/ethereum/solidity/issues/670">returns zero</a> and does not <code>throw</code> an exception when a number is divided by zero. Ensure you're running at least version 0.4.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../protocol_recommendations/" title="Recommendations for Smart Contract Logic" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Recommendations for Smart Contract Logic
              </span>
            </div>
          </a>
        
        
          <a href="../protocol_attacks/" title="Protocol Attacks" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Protocol Attacks
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-f3ab9e5ff8.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>